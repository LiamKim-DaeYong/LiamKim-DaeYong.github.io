<!DOCTYPE html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="generator" content="Jekyll v4.2.2" /><meta property="og:title" content="양방향 연관관계" /><meta property="og:locale" content="en" /><meta name="description" content="양방향 연관관계 양방향 연관관계는 이전 게시글에서 다룬 단방향 연관관계와 다르게 Member에서 Team으로의 접근 뿐만 아니라 Team에서도 Member에 접근할 수 있는 이름 그대로 양방향에서 매핑이 가능한 것을 말한다." /><meta property="og:description" content="양방향 연관관계 양방향 연관관계는 이전 게시글에서 다룬 단방향 연관관계와 다르게 Member에서 Team으로의 접근 뿐만 아니라 Team에서도 Member에 접근할 수 있는 이름 그대로 양방향에서 매핑이 가능한 것을 말한다." /><link rel="canonical" href="https://liamkim-daeyong.github.io/posts/jpa-11/" /><meta property="og:url" content="https://liamkim-daeyong.github.io/posts/jpa-11/" /><meta property="og:site_name" content="D.Yong Blog" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-08-06T00:00:00+09:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="양방향 연관관계" /><meta name="twitter:site" content="@twitter_username" /><meta name="google-site-verification" content="google_meta_tag_verification" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","dateModified":"2022-08-06T00:00:00+09:00","datePublished":"2022-08-06T00:00:00+09:00","description":"양방향 연관관계 양방향 연관관계는 이전 게시글에서 다룬 단방향 연관관계와 다르게 Member에서 Team으로의 접근 뿐만 아니라 Team에서도 Member에 접근할 수 있는 이름 그대로 양방향에서 매핑이 가능한 것을 말한다.","headline":"양방향 연관관계","mainEntityOfPage":{"@type":"WebPage","@id":"https://liamkim-daeyong.github.io/posts/jpa-11/"},"url":"https://liamkim-daeyong.github.io/posts/jpa-11/"}</script><title>양방향 연관관계 | D.Yong Blog</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="D.Yong Blog"><meta name="application-name" content="D.Yong Blog"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener("change", () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } } /* ModeToggle */ const toggle = new ModeToggle(); function flipMode() { if (toggle.hasMode) { if (toggle.isSysDarkPrefer) { if (toggle.isLightMode) { toggle.clearMode(); } else { toggle.setLight(); } } else { if (toggle.isDarkMode) { toggle.clearMode(); } else { toggle.setDark(); } } } else { if (toggle.isSysDarkPrefer) { toggle.setLight(); } else { toggle.setDark(); } } toggle.notify(); } /* flipMode() */ </script><body data-spy="scroll" data-target="#toc" data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/favicons/profile.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title mt-3"> <a href="/">D.Yong Blog</a></div><div class="site-subtitle font-italic">소프트웨어 장인을 꿈꾸는<br>백앤드 개발자</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/LiamKim-DaeYong" aria-label="github" target="_blank" rel="noopener"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener"> <i class="fab fa-twitter"></i> </a> <a href=" javascript:location.href = 'mailto:' + ['liamkim1018','gmail.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>양방향 연관관계</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>양방향 연관관계</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1659711600" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Aug 6, 2022 </em> </span><div class="d-flex justify-content-between"> <span> By <em> <a href="https://github.com/LiamKim-DaeYong">DaeYongKim</a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2485 words"> <em>13 min</em> read</span></div></div></div><div class="post-content"><h1 id="양방향-연관관계">양방향 연관관계</h1><p>양방향 연관관계는 이전 게시글에서 다룬 단방향 연관관계와 다르게 <code class="language-plaintext highlighter-rouge">Member</code>에서 <code class="language-plaintext highlighter-rouge">Team</code>으로의 접근 뿐만 아니라 <code class="language-plaintext highlighter-rouge">Team</code>에서도 <code class="language-plaintext highlighter-rouge">Member</code>에 접근할 수 있는 이름 그대로 양방향에서 매핑이 가능한 것을 말한다.</p><p><img data-src="https://user-images.githubusercontent.com/55070039/183237788-29c02825-6911-4cd4-ad67-59be66f67c80.PNG" alt="캡처" data-proofer-ignore></p><p>객체 연관관계를 살펴보면 <code class="language-plaintext highlighter-rouge">member</code>는 하나의 <code class="language-plaintext highlighter-rouge">team</code>을 가질 수 있다. 반대로 <code class="language-plaintext highlighter-rouge">team</code>은 여러 <code class="language-plaintext highlighter-rouge">member</code>를 가질 수 있다. 그렇기 때문에 <code class="language-plaintext highlighter-rouge">team</code>은 컬렉션으로 <code class="language-plaintext highlighter-rouge">member</code> 정보를 가지고 있어야한다.</p><ul><li>회원 -&gt; 팀 [ Member.team ]<li>팀 -&gt; 회원 [ Team.mebmers(List) ]</ul><p>이제 테이블에서의 관계를 생각해보자. <strong>테이블은 객체와 달리 외래 키 하나로 양방향으로 조회가 가능</strong>하다.</p><p>객체의 경우는 위와 같이 필드 하나로 양방향 접근이 불가능 하여 단방향 접근이 가능한 각각의 필드(Member.team, Team.members)를 사용하였다.</p><p>결론적으로 테이블은 외래 키 하나만으로 양방향 조회가 가능하므로 처음부터 양방향 관계이다. 따라서 양방향 관계를 위해 별도의 작업은 필요치 않다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="nd">@Entity</span>
<span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>
    <span class="nd">@Id1</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">memberId</span><span class="o">;</span>

    <span class="c1">// 연관관계 매핑</span>
    <span class="nd">@ManyToOne</span>
    <span class="nd">@JoinColumn</span><span class="o">(</span><span class="n">name</span> <span class="o">=</span> <span class="s">"team_id"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">Team</span> <span class="n">team</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">username</span><span class="o">;</span>
<span class="o">}</span>

<span class="kd">class</span> <span class="nc">Team</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="nc">Long</span> <span class="n">teamId</span><span class="o">;</span>

    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>

    <span class="c1">//== 양방향 매핑을 위해 필드 추가==//</span>
    <span class="nd">@OneToMany</span><span class="o">(</span><span class="n">mappedBy</span> <span class="o">=</span> <span class="s">"team"</span><span class="o">)</span>
    <span class="kd">private</span> <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
<span class="o">}</span>
</pre></table></code></div></div><p>기존 단뱡향 관계를 양방향 관계로 변경하기 위해서 <code class="language-plaintext highlighter-rouge">Team</code> 엔티티에 <code class="language-plaintext highlighter-rouge">members</code> 필드를 추가하였다. 팀의 입장에서는 여러 회원을 가질 수 있으므로 컬렉션 타입인 List<Member> 타입을 가진다. 그리고 일대다 관계를 매핑하기 위해 `@OneToMany` 어노테이션을 사용하였다. `mappedBy` 속성은 양방향 매핑일 때 사용하는데 반대쪽 매핑의 필드 이름을 값으로 주면 된다.</Member></p><h2 id="일대다-컬렉션-조회"><span class="mr-2">일대다 컬렉션 조회</span><a href="#일대다-컬렉션-조회" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>아래의 예제는 객체 그래프 탐색을 사용하여 팀에서 회원 목록을 조회하는 예제이다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">findMembers</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Team</span> <span class="n">team</span> <span class="o">=</span> <span class="n">em</span><span class="o">.</span><span class="na">find</span><span class="o">(</span><span class="nc">Team</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="s">"team1"</span><span class="o">);</span>
    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="n">team</span><span class="o">.</span><span class="na">getMembers</span><span class="o">();</span>
<span class="o">}</span>
</pre></table></code></div></div><h1 id="연관관계의-주인">연관관계의 주인</h1><p>JPA에서 양방향 매핑을 공부하다보면 연관관계의 주인이라는 이야기를 많이 들어볼 것이다. 양방향 매핑에서 <code class="language-plaintext highlighter-rouge">@OneToMany</code>를 사용하여 일대다 관계를 나타내고 <code class="language-plaintext highlighter-rouge">Member</code>를 컬렉션 타입으로 가지는 것까지는 직관적으로 이해가 될것이다.</p><p>그렇다면 mappedBy 속성은 왜 필요한 것일까? <code class="language-plaintext highlighter-rouge">@OneToMany</code>를 통해 <code class="language-plaintext highlighter-rouge">Team</code>과 <code class="language-plaintext highlighter-rouge">Member</code>가 일대다 관계에 있다는 정보를 충분히 제공할 수 있을 것 같은데 말이다. 이를 설명하기 위해 위에서 테이블과 객체의 연관관계의 차이점에 대해 다시 언급하려 한다.</p><p>테이블은 외래 키 하나로 양방향 관계를 나타낼 수 있었다. 하지만 객체의 경우는 어떠한가? 엄밀히 말해 객체에는 양방향 연관관계라는 것이 존재하지 않는다. 서로 다른 단방향 연관관계 2개를 애플리케이션 로직으로 잘 묶어서 양방향인 것처럼 보이게 할 뿐이다.</p><h2 id="외래-키는-누가-관리하는가"><span class="mr-2">외래 키는 누가 관리하는가?</span><a href="#외래-키는-누가-관리하는가" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>테이블의 경우는 외래 키를 하나만 관리한다. 그리고 우리는 보통 자식 테이블에서 외래 키를 관리한다. 단방향 관계일 경우 객체에서 참조 필드를 가지고 있는 곳에서 외래 키를 관리하면 되었다. 둘다 매핑 정보(참조 필드, 외래 키)를 관리하는 포인트는 한 곳이다.</p><p>그럼 양방향 관계의 경우를 살펴보자. 테이블에서는 별다른 작업이 없었으므로 변동사항이 없다. 하지만 객체의 경우 members 필드가 추가되면서 매핑 정보가 두개가 되었다. <strong>다시말해 객체의 참조는 두개인데 외래 키는 하나이다. 여기에서 차이가 발생된다.</strong></p><p>객체의 입장에서 보면 둘 중 어떤 관계를 사용하여 외래 키를 관리해야 할까? 이런 차이로 인해 JPA에서는 <strong>두 객체 연관관계 중 하나를 정해서 테이블의 외래 키를 관리해야 하는데 이것을 연관관계의 주인</strong>이라 한다.</p><h1 id="양방향-매핑의-규칙-연관관계-주인">양방향 매핑의 규칙: 연관관계 주인</h1><p>양방향 관계를 사용하기 위해서는 지켜야할 규칙이 있는데 두개의 매핑정보(Member.team, Team.members) 중 하나를 연관관계의 주인으로 정해야한다.</p><p><strong>그리고 연관관계의 주인만이 데이터베이스 연관관계와 매핑되고 외래 키를 관리(등록, 수정, 삭제)할 수 있다. 반면에 주인이 아닌 쪽은 읽기만 가능하다.</strong></p><ul><li>주인은 mappedBy 속성을 사용하지 않는다.<li>주인이 아니라면 mappedBy 속성을 사용하여 속성의 값으로 연관관계 주인을 지정해야 한다.</ul><p><strong>연관관계 주인을 정한다는 것은 한마디로 외래 키 관리자를 선택하는 것이다.</strong></p><div class="language-text highlighter-rouge"><div class="code-header"> <span data-label-text="Text"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>테이블의 다대일, 일대다 관계에서는 항상 다 쪽이 외래 키를 가진다. 다 쪽인 @ManyToOne은 항상 연관관계의 주인이 된다.
따라서 @ManyToOne의 경우는 mappedBy를 설정할 수 없으므로 mappedBy 속성을 지원하지 않는다.
</pre></table></code></div></div><h1 id="양방향-연관관계-저장">양방향 연관관계 저장</h1><p>양방향 연관관계를 사용하여 엔티티를 저장하는 예제이다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>

    <span class="c1">// 팀1 저장</span>
    <span class="nc">Team</span> <span class="n">team1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Team</span><span class="o">(</span><span class="s">"team1"</span><span class="o">,</span> <span class="s">"팀1"</span><span class="o">);</span>
    <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">team1</span><span class="o">);</span>

    <span class="c1">// 회원1 저장</span>
    <span class="nc">Member</span> <span class="n">member1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member1"</span><span class="o">,</span> <span class="s">"회원1"</span><span class="o">);</span>
    <span class="n">member1</span><span class="o">.</span><span class="na">setTeam</span><span class="o">(</span><span class="n">team1</span><span class="o">);</span> <span class="c1">// 연관관계 설정</span>
    <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">member1</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위 코드를 살펴보면 연관관계의 주인인 Member(team 필드)를 통해서 회원과 팀의 연관관계를 설정하고 저장하는 것을 볼 수 있다. 이는 이전 단방향 연관관계에서 살펴본 회원과 팀을 저장하는 예제와 동일하다.</p><p>그렇다면 연관관계의 주인이 아닌 곳에서 연관관계를 지정하면 어떻게 될까?</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">save</span><span class="o">()</span> <span class="o">{</span>
    <span class="c1">// 회원1 저장</span>
    <span class="nc">Member</span> <span class="n">member1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member1"</span><span class="o">,</span> <span class="s">"회원1"</span><span class="o">);</span>
    <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">member1</span><span class="o">);</span>

    <span class="c1">// 팀1 저장</span>
    <span class="nc">Team</span> <span class="n">team1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Team</span><span class="o">(</span><span class="s">"team1"</span><span class="o">,</span> <span class="s">"팀1"</span><span class="o">);</span>
    <span class="n">team1</span><span class="o">.</span><span class="na">getMembers</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">member1</span><span class="o">);</span> <span class="c1">// 무시(연관관계 주인이 아님)</span>
    <span class="n">em</span><span class="o">.</span><span class="na">persist</span><span class="o">(</span><span class="n">team1</span><span class="o">);</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위의 경우는 연관관계의 주인이 아닌 Team(members 필드)을 통해서 연관관계를 설정하여 저장을 시도한다. 이 경우는 위에서 언급하였듯 연관관계 주인이 아닌 필드는 <strong>읽기만 가능</strong>하기 때문에 주인이 아닌 곳에서 입력된 값은 외래 키에 영향을 주지 않는다.</p><p>그리고 이것이 <strong>양방향 연관관계를 사용할 때의 주의점</strong>이다. 연관관계의 주인에는 값을 입력하지 않고, 주인이 아닌 곳에만 값을 입력하는 것인데 외래 키 값이 정상적으로 저장되지 않는다면 이것부터 의심해보자.</p><h1 id="순수한-객체까지-고려한-양방향-연관관계">순수한 객체까지 고려한 양방향 연관관계</h1><p>외래 키를 저장하기 위해서는 연관관계 주인에 값을 세팅해야 한다. 그렇다면 연관관계의 주인이 아닌 곳에 값을 지정하는 것이 의미가 없는 것인가?</p><p>객체 관점에서는 양쪽 방향에 모두 값을 입력해주는 것이 가장 안전하다. 이유는 객체 입장에서는 단방향 2개를 이용해 양방향인 것처럼 표현하고 있다. 그렇다면 만약 한쪽에만 값이 지정되어 있고 반대쪽에 값이 없다면 데이터를 조회하는 시점에 불일치 되는 현상이 발생될 수 있다. 이는 우리가 기대하는 양방향 연관관계의 결과가 아닐 것이다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Team</span> <span class="n">team1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Team</span><span class="o">(</span><span class="s">"team1"</span><span class="o">,</span> <span class="s">"팀1"</span><span class="o">);</span>
    <span class="nc">Member</span> <span class="n">member1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member1"</span><span class="o">,</span> <span class="s">"회원1"</span><span class="o">);</span>
    <span class="nc">Member</span> <span class="n">member2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member2"</span><span class="o">,</span> <span class="s">"회원2"</span><span class="o">);</span>

    <span class="n">member1</span><span class="o">.</span><span class="na">setTeam</span><span class="o">(</span><span class="n">team1</span><span class="o">);</span> <span class="c1">// 연관관계 설정</span>
    <span class="n">member2</span><span class="o">.</span><span class="na">setTeam</span><span class="o">(</span><span class="n">team1</span><span class="o">);</span> <span class="c1">// 연관관계 설정</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="n">team1</span><span class="o">.</span><span class="na">getMembers</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">members</span><span class="o">.</span><span class="na">size</span><span class="o">());</span> <span class="c1">// 결과: 0</span>
<span class="o">}</span>
</pre></table></code></div></div><p>위 코드를 살펴보면 연관관계의 주인인 <code class="language-plaintext highlighter-rouge">Member</code>를 통해 <code class="language-plaintext highlighter-rouge">Team</code>을 설정하였다. 그렇다면 <code class="language-plaintext highlighter-rouge">Team</code>의 입장에서는 두 개의 <code class="language-plaintext highlighter-rouge">Member</code>를 가지고 있는 결과가 된다. 하지만 <code class="language-plaintext highlighter-rouge">Member.team</code>에만 값을 설정하였기 때문에 <code class="language-plaintext highlighter-rouge">Team.members</code>의 size는 0인 결과가 나온다.</p><div class="language-java highlighter-rouge"><div class="code-header"> <span data-label-text="Java"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="kd">public</span> <span class="kt">void</span> <span class="nf">test</span><span class="o">()</span> <span class="o">{</span>
    <span class="nc">Team</span> <span class="n">team1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Team</span><span class="o">(</span><span class="s">"team1"</span><span class="o">,</span> <span class="s">"팀1"</span><span class="o">);</span>
    <span class="nc">Member</span> <span class="n">member1</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member1"</span><span class="o">,</span> <span class="s">"회원1"</span><span class="o">);</span>
    <span class="nc">Member</span> <span class="n">member2</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">Member</span><span class="o">(</span><span class="s">"member2"</span><span class="o">,</span> <span class="s">"회원2"</span><span class="o">);</span>

    <span class="n">member1</span><span class="o">.</span><span class="na">setTeam</span><span class="o">(</span><span class="n">team1</span><span class="o">);</span> <span class="c1">// 연관관계 설정</span>
    <span class="n">team1</span><span class="o">.</span><span class="na">getMembers</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">member1</span><span class="o">);</span>

    <span class="n">member2</span><span class="o">.</span><span class="na">setTeam</span><span class="o">(</span><span class="n">team1</span><span class="o">);</span> <span class="c1">// 연관관계 설정</span>
    <span class="n">team1</span><span class="o">.</span><span class="na">getMembers</span><span class="o">().</span><span class="na">add</span><span class="o">(</span><span class="n">member2</span><span class="o">);</span>

    <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Member</span><span class="o">&gt;</span> <span class="n">members</span> <span class="o">=</span> <span class="n">team1</span><span class="o">.</span><span class="na">getMembers</span><span class="o">();</span>
    <span class="nc">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">members</span><span class="o">.</span><span class="na">size</span><span class="o">());</span> <span class="c1">// 결과: 2</span>
<span class="o">}</span>
</pre></table></code></div></div><p>이렇게 양쪽 모두 관계를 설정하면 결과했던 2가 출력된다. 이렇듯 객체의 관계까지 고려하여 양쪽 모두 연관관계를 설정하는 것이 좋다.</p><h1 id="참고">참고</h1><ul><li><a href="https://www.inflearn.com/course/ORM-JPA-Basic/dashboard">인프런 자바 ORM 표준 JPA 프로그래밍 - 기본편(김영한)</a><li><a href="http://www.kyobobook.co.kr/product/detailViewKor.laf?mallGb=KOR&amp;ejkGb=KOR&amp;barcode=9788960777330">자바 ORM 표준 JPA 프로그래밍</a></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/jpa/'>JPA</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/jpa/" class="post-tag no-text-decoration" >JPA</a> <a href="/tags/%EC%96%91%EB%B0%A9%ED%96%A5-%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84/" class="post-tag no-text-decoration" >양방향 연관관계</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%EC%96%91%EB%B0%A9%ED%96%A5+%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84+-+D.Yong+Blog&url=https%3A%2F%2Fliamkim-daeyong.github.io%2Fposts%2Fjpa-11%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%EC%96%91%EB%B0%A9%ED%96%A5+%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84+-+D.Yong+Blog&u=https%3A%2F%2Fliamkim-daeyong.github.io%2Fposts%2Fjpa-11%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fliamkim-daeyong.github.io%2Fposts%2Fjpa-11%2F&text=%EC%96%91%EB%B0%A9%ED%96%A5+%EC%97%B0%EA%B4%80%EA%B4%80%EA%B3%84+-+D.Yong+Blog" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/jpa-09/">필드와 컬럼 캐핑</a><li><a href="/posts/jpa-10/">단방향 연관관계</a><li><a href="/posts/jpa-05/">준영속 상태</a><li><a href="/posts/jpa-06/">병합(Merge)</a><li><a href="/posts/jpa-07/">엔티티 매핑</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/srping/">Srping</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/mvc/">MVC</a> <a class="post-tag" href="/tags/applicationcontext/">ApplicationContext</a> <a class="post-tag" href="/tags/1%EC%B0%A8-%EC%BA%90%EC%8B%9C/">1차 캐시</a> <a class="post-tag" href="/tags/entity-mapping/">Entity Mapping</a> <a class="post-tag" href="/tags/%EB%B9%88-%EC%83%9D%EB%AA%85%EC%A3%BC%EA%B8%B0/">빈 생명주기</a> <a class="post-tag" href="/tags/%EC%83%81%EC%86%8D%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91/">상속관계 매핑</a> <a class="post-tag" href="/tags/%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/">영속성 컨텍스트</a></div></div></div><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@1.0.1/dist/bootstrap-toc.min.js"></script><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc" data-toggle="toc"></nav></div></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4"><div id="related-posts" class="mt-5 mb-2 mb-sm-4"><h3 class="pt-2 mt-1 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/jpa-05/"><div class="card-body"> <em class="small" data-ts="1659279600" data-df="ll" > Aug 1, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>준영속 상태</h3><div class="text-muted small"><p> 준영속 상태 영속성 컨테스트가 관리하는 영속 상태의 엔티티가 영속성 컨텍스트에서 분리된(detached) 것을 준영속 상태라 한다. 따라서 준영속 상태가 된 엔티티는 영속성 컨텍스트가 제공하는 기능을 사용할 수 없게된다. 준영속 상태 만들기 영속 상태의 엔티티를 준영속 상태로 만드는 방법은 크게 3가지가 있다. em.detach(entity):...</p></div></div></a></div><div class="card"> <a href="/posts/jpa-06/"><div class="card-body"> <em class="small" data-ts="1659279600" data-df="ll" > Aug 1, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>병합(Merge)</h3><div class="text-muted small"><p> 병합 준영속 상태의 엔티티를 다시 영속 상태로 변경하려면 병합을 사용하면 된다. merge() 메소드는 준영속 상태의 엔티티를 받아서 그 정보로 새로운 영속 상태의 엔티티를 반환한다. 준영속 병합 예제 public class ExamMerge { static EntityManagerFactory emf = Persistence.createEn...</p></div></div></a></div><div class="card"> <a href="/posts/jpa-07/"><div class="card-body"> <em class="small" data-ts="1659366000" data-df="ll" > Aug 2, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>엔티티 매핑</h3><div class="text-muted small"><p> 엔티티 매핑 JPA를 사용함에 있어 가장 중요한 것은 엔티티와 테이블을 매핑하는 것이다. JPA는 다양한 매핑 어노테이션을 지원하고 크게 4가지로 분류할 수 있다. 객체와 테이블 매핑: @Entity, @Table 기본 키 매핑: @Id 필드와 컬럼 매핑: @Column 연관관계 매핑: @ManyToOne, @JoinColumn, @...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/jpa-10/" class="btn btn-outline-primary" prompt="Older"><p>단방향 연관관계</p></a> <a href="/posts/jpa-12/" class="btn btn-outline-primary" prompt="Newer"><p>상속관계 매핑</p></a></div><div id="disqus_thread" class="pt-2 pb-2"><p class="text-center text-muted small"> Comments powered by <a href="https://disqus.com/">Disqus</a>.</p></div><script type="text/javascript"> var disqus_config = function () { this.page.url = 'https://liamkim-daeyong.github.io/posts/jpa-11/'; this.page.identifier = '/posts/jpa-11/'; }; /* Lazy loading */ var disqus_observer = new IntersectionObserver(function (entries) { if(entries[0].isIntersecting) { (function () { var d = document, s = d.createElement('script'); s.src = 'https://liamkim-daeyong-github-io-1.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); disqus_observer.disconnect(); } }, { threshold: [0] }); disqus_observer.observe(document.querySelector('#disqus_thread')); /* Auto switch theme */ function reloadDisqus() { /* Disqus hasn't been loaded */ if (typeof DISQUS === "undefined") { return; } if (document.readyState == 'complete') { DISQUS.reset({ reload: true, config: disqus_config }); } } const modeToggle = document.querySelector(".mode-toggle"); if (typeof modeToggle !== "undefined") { /* modeToggle.addEventListener('click', reloadDisqus); // not pretty for 'color-scheme' */ window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', reloadDisqus); } </script></div></div><footer class="row pl-3 pr-3"><div class="col-12 d-flex justify-content-between align-items-center text-muted pl-0 pr-0"><div class="footer-left"><p class="mb-0"> © 2022 <a href="https://github.com/LiamKim-DaeYong">DaeYongKim</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author.">Some rights reserved.</span></p></div><div class="footer-right"><p class="mb-0"> Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></footer></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/srping/">Srping</a> <a class="post-tag" href="/tags/jpa/">JPA</a> <a class="post-tag" href="/tags/http/">HTTP</a> <a class="post-tag" href="/tags/mvc/">MVC</a> <a class="post-tag" href="/tags/applicationcontext/">ApplicationContext</a> <a class="post-tag" href="/tags/1%EC%B0%A8-%EC%BA%90%EC%8B%9C/">1차 캐시</a> <a class="post-tag" href="/tags/entity-mapping/">Entity Mapping</a> <a class="post-tag" href="/tags/%EB%B9%88-%EC%83%9D%EB%AA%85%EC%A3%BC%EA%B8%B0/">빈 생명주기</a> <a class="post-tag" href="/tags/%EC%83%81%EC%86%8D%EA%B4%80%EA%B3%84-%EB%A7%A4%ED%95%91/">상속관계 매핑</a> <a class="post-tag" href="/tags/%EC%98%81%EC%86%8D%EC%84%B1-%EC%BB%A8%ED%85%8D%EC%8A%A4%ED%8A%B8/">영속성 컨텍스트</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3"></p><button type="button" class="btn btn-primary" aria-label="Update"> </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No result founds.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lozad/dist/lozad.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script>
